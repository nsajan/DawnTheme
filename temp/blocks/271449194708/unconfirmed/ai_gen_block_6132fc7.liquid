{% doc %}
  @prompt
    I need a radio button saying buying for self or someone else, when someone else is selected i need to see a text box to collect student email. and store it

{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-purchase-type-form-{{ ai_gen_id }} {
    padding: {{ block.settings.padding }}px;
    background-color: {{ block.settings.background_color }};
    border-radius: {{ block.settings.border_radius }}px;
    max-width: 500px;
  }

  .ai-purchase-type-form__heading-{{ ai_gen_id }} {
    color: {{ block.settings.text_color }};
    margin: 0 0 20px 0;
    font-size: {{ block.settings.heading_size }}px;
    font-weight: 600;
  }

  .ai-purchase-type-form__radio-group-{{ ai_gen_id }} {
    margin-bottom: 20px;
  }

  .ai-purchase-type-form__radio-option-{{ ai_gen_id }} {
    display: flex;
    align-items: center;
    margin-bottom: 12px;
    cursor: pointer;
  }

  .ai-purchase-type-form__radio-input-{{ ai_gen_id }} {
    margin-right: 10px;
    width: 18px;
    height: 18px;
    cursor: pointer;
  }

  .ai-purchase-type-form__radio-label-{{ ai_gen_id }} {
    color: {{ block.settings.text_color }};
    font-size: {{ block.settings.text_size }}px;
    cursor: pointer;
    user-select: none;
  }

  .ai-purchase-type-form__email-field-{{ ai_gen_id }} {
    margin-top: 16px;
    opacity: 0;
    max-height: 0;
    overflow: hidden;
    transition: opacity 0.3s ease, max-height 0.3s ease;
  }

  .ai-purchase-type-form__email-field-{{ ai_gen_id }}.visible {
    opacity: 1;
    max-height: 100px;
  }

  .ai-purchase-type-form__email-label-{{ ai_gen_id }} {
    display: block;
    color: {{ block.settings.text_color }};
    font-size: {{ block.settings.text_size }}px;
    margin-bottom: 8px;
    font-weight: 500;
  }

  .ai-purchase-type-form__email-input-{{ ai_gen_id }} {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid {{ block.settings.input_border_color }};
    border-radius: {{ block.settings.input_border_radius }}px;
    font-size: {{ block.settings.text_size }}px;
    background-color: {{ block.settings.input_background_color }};
    color: {{ block.settings.text_color }};
    box-sizing: border-box;}

  .ai-purchase-type-form__email-input-{{ ai_gen_id }}:focus {
    outline: 2px solid {{ block.settings.focus_color }};
    outline-offset: 2px;border-color: {{ block.settings.focus_color }};
  }

  .ai-purchase-type-form__submit-button-{{ ai_gen_id }} {
    margin-top: 20px;
    padding: 12px 24px;
    background-color: {{ block.settings.button_color }};
    color: {{ block.settings.button_text_color }};
    border: none;
    border-radius: {{ block.settings.button_border_radius }}px;
    font-size: {{ block.settings.text_size }}px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .ai-purchase-type-form__submit-button-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.button_hover_color }};
  }

  .ai-purchase-type-form__success-{{ ai_gen_id }} {
    color: {{ block.settings.success_color }};
    margin-top: 12px;
    font-size: {{ block.settings.text_size }}px;
  }

  .ai-purchase-type-form__error-{{ ai_gen_id }} {
    color: {{ block.settings.error_color }};
    margin-top: 12px;
    font-size: {{ block.settings.text_size }}px;
  }
{% endstyle %}

<purchase-type-form-{{ ai_gen_id }}
  class="ai-purchase-type-form-{{ ai_gen_id }}"
  {{ block.shopify_attributes }}
>
  {%- form 'contact' -%}
    {%- if block.settings.heading != blank -%}
      <h3 class="ai-purchase-type-form__heading-{{ ai_gen_id }}">{{ block.settings.heading }}</h3>
    {%- endif -%}<div class="ai-purchase-type-form__radio-group-{{ ai_gen_id }}"><div class="ai-purchase-type-form__radio-option-{{ ai_gen_id }}">
        <input
          type="radio"
          id="purchase-self-{{ ai_gen_id }}"
          name="contact[purchase_type]"
          value="self"
          class="ai-purchase-type-form__radio-input-{{ ai_gen_id }}"
          {% if form.purchase_type == 'self' or form.purchase_type == blank %}checked{% endif %}
        >
        <label
          for="purchase-self-{{ ai_gen_id }}"
          class="ai-purchase-type-form__radio-label-{{ ai_gen_id }}"
        >
          {{ block.settings.self_label }}
        </label>
      </div>

      <div class="ai-purchase-type-form__radio-option-{{ ai_gen_id }}">
        <input
          type="radio"
          id="purchase-other-{{ ai_gen_id }}"
          name="contact[purchase_type]"
          value="someone_else"
          class="ai-purchase-type-form__radio-input-{{ ai_gen_id }}"
          {% if form.purchase_type == 'someone_else' %}checked{% endif %}
        >
        <label
          for="purchase-other-{{ ai_gen_id }}"
          class="ai-purchase-type-form__radio-label-{{ ai_gen_id }}"
        >
          {{ block.settings.other_label }}
        </label>
      </div>
    </div>

    <div 
      class="ai-purchase-type-form__email-field-{{ ai_gen_id }} {% if form.purchase_type == 'someone_else' %}visible{% endif %}"
      id="email-field-{{ ai_gen_id }}"
    >
      <label
        for="student-email-{{ ai_gen_id }}"
        class="ai-purchase-type-form__email-label-{{ ai_gen_id }}"
      >
        {{ block.settings.email_label }}
      </label>
      <input
        type="email"
        id="student-email-{{ ai_gen_id }}"
        name="contact[student_email]"
        class="ai-purchase-type-form__email-input-{{ ai_gen_id }}"
        value="{{ form.student_email }}"
        placeholder="{{ block.settings.email_placeholder }}"
        autocomplete="email"
        autocorrect="off"
        autocapitalize="off"
      >
    </div>

    <button
      type="submit"
      class="ai-purchase-type-form__submit-button-{{ ai_gen_id }}"
    >
      {{ block.settings.submit_label }}
    </button>

    {%- if form.posted_successfully? -%}
      <div class="ai-purchase-type-form__success-{{ ai_gen_id }}">
        {{ block.settings.success_message }}
      </div>
    {%- endif -%}

    {%- if form.errors -%}
      <div class="ai-purchase-type-form__error-{{ ai_gen_id }}">
        {%- for field in form.errors -%}
          {{ field | capitalize }} {{ form.errors.messages[field] }}
        {%- endfor -%}
      </div>
    {%- endif -%}
  {%- endform -%}
</purchase-type-form-{{ ai_gen_id }}><script>
  (function() {
    class PurchaseTypeForm{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
      }

      connectedCallback() {
        this.radioInputs = this.querySelectorAll('.ai-purchase-type-form__radio-input-{{ ai_gen_id }}');
        this.emailField = this.querySelector('#email-field-{{ ai_gen_id }}');
        this.emailInput = this.querySelector('#student-email-{{ ai_gen_id }}');
        
        this.setupEventListeners();
      }

      setupEventListeners() {
        this.radioInputs.forEach(radio => {
          radio.addEventListener('change', () => {
            this.toggleEmailField();
          });
        });}

      toggleEmailField() {
        const selectedValue = this.querySelector('.ai-purchase-type-form__radio-input-{{ ai_gen_id }}:checked').value;
        
        if (selectedValue === 'someone_else') {
          this.emailField.classList.add('visible');
          this.emailInput.setAttribute('required', 'required');
          this.emailInput.focus();
        } else {
          this.emailField.classList.remove('visible');
          this.emailInput.removeAttribute('required');
          this.emailInput.value = '';
        }
      }
    }

    customElements.define('purchase-type-form-{{ ai_gen_id }}', PurchaseTypeForm{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Purchase type form",
  "settings": [
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Who are you buying for?"
    },
    {
      "type": "text",
      "id": "self_label",
      "label": "Self option label",
      "default": "Buying for myself"
    },
    {
      "type": "text",
      "id": "other_label",
      "label": "Someone else option label",
      "default": "Buying for someone else"
    },
    {
      "type": "text",
      "id": "email_label",
      "label": "Email field label",
      "default": "Student email address"
    },
    {
      "type": "text",
      "id": "email_placeholder",
      "label": "Email placeholder",
      "default": "Enter student's email"
    },
    {
      "type": "text",
      "id": "submit_label",
      "label": "Submit button label",
      "default": "Continue"
    },
    {
      "type": "text",
      "id": "success_message",
      "label": "Success message",
      "default": "Thank you! Your information has been submitted."
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "input_background_color",
      "label": "Input background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "input_border_color",
      "label": "Input border",
      "default": "#cccccc"
    },
    {
      "type": "color",
      "id": "focus_color",
      "label": "Focus",
      "default": "#005fcc"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Button background",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button text",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_hover_color",
      "label": "Button hover background",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "success_color",
      "label": "Success message",
      "default": "#008060"
    },
    {
      "type": "color",
      "id": "error_color",
      "label": "Error message",
      "default": "#D82C0D"
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "range",
      "id": "padding",
      "min": 10,
      "max": 50,
      "step": 5,
      "unit": "px",
      "label": "Padding",
      "default": 30
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Border radius",
      "default": 8
    },
    {
      "type": "range",
      "id": "input_border_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Input border radius",
      "default": 4
    },
    {
      "type": "range",
      "id": "button_border_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Button border radius",
      "default": 4
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 16,
      "max": 32,
      "step": 2,
      "unit": "px",
      "label": "Heading size",
      "default": 20
    },
    {
      "type": "range",
      "id": "text_size",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Text size",
      "default": 16
    }
  ],
  "presets": [
    {
      "name": "Purchase type form"
    }
  ],
  "tag": null
}
{% endschema %}
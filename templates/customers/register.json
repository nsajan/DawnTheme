/*
 * ------------------------------------------------------------
 * IMPORTANT: The contents of this file are auto-generated.
 *
 * This file may be updated by the Shopify admin theme editor
 * or related systems. Please exercise caution as any changes
 * made to this file may be overwritten.
 * ------------------------------------------------------------
 */
{
  "sections": {
    "main": {
      "type": "main-register",
      "settings": {
        "padding_top": 36,
        "padding_bottom": 36
      }
    },
    "custom_liquid_aMUB7M": {
      "type": "custom-liquid",
      "name": "t:sections.custom-liquid.presets.name",
      "settings": {
        "custom_liquid": "<script>\n(function () {\n  if (!/\\/account\\/register(?:\\?|$)/.test(location.pathname + location.search)) return;\n\n  const params = new URLSearchParams(location.search);\n  const token = params.get(\"token\");\n  if (!token) return; // nu facem nimic dacă nu există token\n\n  const form =\n    document.querySelector('form#create_customer') ||\n    document.querySelector('form[action*=\"/account\"]') ||\n    document.querySelector(\"form\");\n  if (!form) return;\n\n  const ONBOARDING_URL = \"https://theme-appext--development.gadget.app/proxy/onboarding\";\n\n  const makeIdempotencyKey = (t, e) => {\n    try { return btoa(`${t}|${(e||'').trim().toLowerCase()}`); } catch (_e) { return `${t}:${e}`; }\n  };\n\n  if (form.dataset.lmsHooked === \"1\") return;\n  form.dataset.lmsHooked = \"1\";\n\n  form.addEventListener(\"submit\", function () {\n    try {\n      const first = form.querySelector('input[name=\"customer[first_name]\"]')?.value?.trim() || \"\";\n      const last  = form.querySelector('input[name=\"customer[last_name]\"]')?.value?.trim() || \"\";\n      const email = form.querySelector('input[name=\"customer[email]\"]')?.value?.trim() || \"\";\n\n      const payload = {\n        token,\n        firstName: first,\n        lastName: last,\n        email,\n        shop: \"{{ shop.permanent_domain }}\",\n        source: \"register\",\n        at: new Date().toISOString(),\n        idempotencyKey: makeIdempotencyKey(token, email),\n      };\n\n      // folosim fetch + keepalive (CORS preflight OK)\n      fetch(ONBOARDING_URL, {\n        method: \"POST\",\n        mode: \"cors\",\n        credentials: \"omit\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(payload),\n        keepalive: true\n      }).catch(() => { /* non-blocking */ });\n    } catch (_e) { /* non-blocking */ }\n  });\n})();\n</script>",
        "color_scheme": "",
        "padding_top": 40,
        "padding_bottom": 52
      }
    }
  },
  "order": [
    "main",
    "custom_liquid_aMUB7M"
  ]
}
